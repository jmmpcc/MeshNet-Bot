# === Telegram ===
TELEGRAM_TOKEN=
ADMIN_IDS=

# === Nodo Meshtastic ===
MESHTASTIC_HOST=xxx.xxx.xxx.xxx
MESH_NODE_HOST=xxx.xxx.xxx.xxx

DEBUG_KM=1
HOME_NODE_ID=!xxxxxx

# Mapa Live (opcional)
HOME_LAT=xx.xxxxxxx 
HOME_LON=xx.xxxxx
MAP_TILE_URL=https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png
MAP_ATTRIBUTION=&copy; OpenStreetMap contributors

BROKER_PORT=8765
BACKLOG_PORT=8766

# Descomentar si BROKER, BOT y APRS estan en local (MISMA MÁQUINA):
# - En Windows: el APRS y el broker comparten host Docker → 127.0.0.1
# - En Raspberry: también 127.0.0.1, todo vive en la misma RPi.
BROKER_HOST=127.0.0.1
BROKER_PORT=8765
BROKER_CTRL_HOST=127.0.0.1
BROKER_CTRL_PORT=8766

# === Comentar si Broker remoto (Raspberry) visto desde el PC ===
#BROKER_HOST=192.168.1.187
#BROKER_PORT=8765
#BROKER_CTRL_HOST=192.168.1.187
#BROKER_CTRL_PORT=8766


# Raspberry,, siempre never
#BOT_PAUSE_MODE=never

# Windows: auto o always
BOT_PAUSE_MODE= always


# Muy recomendable mantenerlo a 1 en Docker (evita doble sesión TCP al nodo)
DISABLE_BOT_TCP=1
# No mostramos las notificaciones de tareas ejecutadas
NOTIFY_DONE=1 
#antirebote
NOTIFY_DONE_TTL=600 

# === APRS-IS (iGate hacia Internet) ===
APRSIS_USER=       # tu indicativo-SSID de iGate
APRSIS_PASSCODE=        # passcode APRS-IS de EB2EAS-10
APRSIS_HOST=rotate.aprs2.net # opcional; este es el defecto
APRSIS_PORT=14580            # opcional; este es el defecto
APRSIS_FILTER=m/50           # opcional; radio 50 km alrededor de tu posición

# Longitud trama de APRS, trunca en varios tramas si se supera
APRS_MAX_LEN=67
#1 sólo APRS cuando /diario ambos | 0 desactiva y envia a APRS Y MESH
APRS_GATE_ECHO=1     

# 1 Pasarela ACTIVA
APRS_GATE_ENABLED=1
# 1 Activo, se visuaizan las tramas para depuración
APRS_DEBUG=0
#sólo se permiten mensajes de estos indicativos
APRS_ALLOWED_SOURCES=


# === APRS ===

# Caso sencillo: BROKER, BOT y pasarela APRS estan en la MISMA máquina
# (PC o Raspberry). UDP de control local.
APRS_CTRL_HOST=127.0.0.1   
APRS_CTRL_PORT=9464

# Caso avanzado (no lo usamos ahora): broker/bot en otra máquina:
# APRS_CTRL_HOST=IP_DEL_PC_DONDE_CORRE_APRS
# APRS_CTRL_PORT=9464

# Indicativo de la pasarela
APRS_CALL=

# KISS_HOST:
# - Si APRS y direwolf/soundmodem están en el MISMO host Docker en Windows → host.docker.internal
# - Si APRS corre en Raspberry y el TNC está en un PC → pon aquí la IP del PC (ej. 192.168.1.30)
KISS_HOST=host.docker.internal
KISS_PORT=8100

MESHTASTIC_CH=0
# Activa o desactiva el eco del mensaje enviaso de APRS a MESH
APRS_ECHO_HOME_ENABLED=1
# prefijo del GATEWAY
APRS_GATEWAY_PREFIX=

# Periodo de gracia antes de arrancar el BOT para que conecte el BROKER
BOT_START_DELAY=60

# =========================
# Pasarela entre dos nodos
# =========================
# Nodo A (normalmente el que ya usas en MESHTASTIC_HOST)
A_HOST=${MESHTASTIC_HOST}
A_PORT=4403

# Nodo B (el segundo nodo, con preset distinto)
B_HOST=
B_PORT=4403

# Mapeo de canales (A→B y B→A).
# Si ambos nodos usan los mismos canales, deja "espejo" 0:0,1:1,2:2
A2B_CH_MAP=0:0,1:1,2:2,3:3,4:4,5:5
B2A_CH_MAP=0:0,1:1,2:2,3:3,4:4,5:5

# Qué reenviar
FORWARD_TEXT=1
# 1 si quieres cruzar posiciones/telemetría (como resumen de texto)
FORWARD_POSITION=0   
# 1 si quieres pedir ACK en envíos (solo tiene sentido en unicast)
REQUIRE_ACK=0         
# Anti-ruido # máx. mensajes/minuto por sentido
RATE_LIMIT_PER_SIDE=8 
# segundos de ventana antidupe
DEDUP_TTL=45          
# segundos (defecto: 60)
BRIDGE_PEER_DOWN_BACKOFF=75   


# Marcado opcional (vacío para no marcar)
TAG_BRIDGE=[BRIDGE]
# Etiquetas específicas por dirección (opcionales)
TAG_BRIDGE_A2B=[BRIDGE A→B]
TAG_BRIDGE_B2A=[BRIDGE B→A]

# =========================
# Bridge embebido en el broker (opcional)
# =========================
 # 1=activar dentro del broker, 0=desactivar
BRIDGE_ENABLED=0
             
# Nodo B (ya lo tienes definido)
BRIDGE_B_HOST=${B_HOST}       
BRIDGE_B_PORT=${B_PORT}

# Mapeo de canales (usa los mismos si quieres espejo)
BRIDGE_A2B_CH_MAP=${A2B_CH_MAP}
BRIDGE_B2A_CH_MAP=${B2A_CH_MAP}

# Qué reenviar
BRIDGE_FORWARD_TEXT=${FORWARD_TEXT}
BRIDGE_FORWARD_POSITION=${FORWARD_POSITION}
BRIDGE_REQUIRE_ACK=${REQUIRE_ACK}

# Anti-ruido
BRIDGE_RATE_LIMIT_PER_SIDE=${RATE_LIMIT_PER_SIDE}
BRIDGE_DEDUP_TTL=${DEDUP_TTL}

# Etiquetas
TAG_BRIDGE=${TAG_BRIDGE}
TAG_BRIDGE_A2B=${TAG_BRIDGE_A2B}
TAG_BRIDGE_B2A=${TAG_BRIDGE_B2A}

# Web panel
WEB_BIND=0.0.0.0
WEB_PORT=8080


# --- RUTAS DE ENTRADA Y SALIDA ------------------------------------------------

# Archivo JSONL con posiciones registradas por el broker.
BOT_POSITIONS_PATH=bot_data/positions.jsonl

# Archivo JSONL con cobertura (posiciones históricas con SNR, hops, etc.).
BOT_COVERAGE_PATH=bot_data/coverage.jsonl

# Archivo JSONL con mensajes almacenados cuando el broker estuvo offline.
BOT_OFFLINE_LOG_PATH=bot_data/broker_offline_log.jsonl

# Archivo JSONL con telemetría (solo si LOG_TELEMETRY=1).
BOT_TELEMETRY_PATH=bot_data/telemetry_log.jsonl

# Carpeta donde se guardarán los informes CSV y JSON generados por las auditorías.
BOT_REPORTS_DIR=bot_data/reportes

# Carpeta donde se guardarán los mapas HTML generados (si no se define, usa BOT_REPORTS_DIR).
BOT_MAPS_DIR=bot_data/reportes


# --- PARÁMETROS GENERALES DE AUDITORÍA ---------------------------------------

# Ventana temporal en horas para analizar los datos (por defecto 72h).
# Un valor mayor analiza más histórico y detecta persistencia, pero el proceso es más lento.
AUD_WINDOW_H=72

# Mínimo número de muestras (SNR, hops, RSSI) necesarias para considerar un vecino válido.
AUD_MIN_SAMPLES=1

# Tiempo máximo en segundos desde la última muestra para que un vecino se considere activo.
# 72h = 259200 segundos. 48h 172800 
# 24h: 86400 sg.
# 72h: 259200
# 240h (7 dias) 604800
AUD_STALE_SEC=604800

# Número máximo de hops considerados como aceptables (rutas cortas).
AUD_HOPS_MAX=3

# Valor mínimo de SNR p50 (mediana) para considerar un enlace “válido”.
AUD_SNR_OK=0.0

# Valor de SNR p90 a partir del cual un enlace se considera “fuerte”.
AUD_P90_STRONG=8.0

# Mínimo de vecinos fuertes necesarios para recomendar el modo ROUTER.
AUD_ROUTER_NEI=6

# Máximo de routers que deberían existir en una red urbana para evitar saturación.
AUD_BACKBONE_MAX=5

# Valor de hop_limit sugerido por defecto para nodos que no sean routers.
AUD_HOP_DEFAULT=4

# Intervalo de baliza (en segundos) recomendado si el nodo se comporta como ROUTER.
AUD_BEACON_R=600

# Intervalo de baliza recomendado si el nodo es CLIENT o CLIENT_MUTE.
AUD_BEACON_C=1200

# Intervalo de telemetría (en segundos) recomendado para nodos ROUTER.
AUD_TEL_R=1200

# Intervalo de telemetría recomendado para nodos CLIENT.
AUD_TEL_C=1800


# --- PARÁMETROS DE PERSISTENCIA (AUDITORÍA INTEGRAL) --------------------------

# Porcentaje mínimo de horas escuchadas respecto al total analizado
# (0.25 = 25% de presencia en la ventana analizada).
AUD_PERSIST_RATIO_MIN=0.45

# Número mínimo de días distintos con actividad para considerar un nodo “persistente”.
AUD_PERSIST_DAYS_MIN=4

# Número máximo de hops para considerar “vecinos” (0=directos, 1=un salto)
AUD_HOPS_NEIGHBOR_MAX=1

# Zona horaria para calcular el histograma horario y los tiempos “first/last”.
AUD_TZ=Europe/Madrid


# --- MAPAS DE CALOR (HEATMAP) ------------------------------------------------

# 1 para generar mapas HTML (con capas de persistentes en verde y volátiles en azul).
# 0 para desactivar la generación de mapas.
AUD_HEATMAP_ENABLE=1

# Coordenadas opcionales para fijar el encuadre del mapa (lat1,lon1,lat2,lon2).
# Ejemplo: 41.65,-0.95,41.85,-0.75
AUD_HEATMAP_BOUNDS=


# --- PARÁMETROS DE ESTIMACIÓN DE CARGA LORA ----------------------------------

# Spreading Factor estimado (12 = largo alcance, bajo bitrate).
AUD_LORA_SF=12

# Ancho de banda en kHz (125 habitual en redes Meshtastic).
AUD_LORA_BW=125

# Code rate (5=4/5, 8=4/8). Valores altos reducen velocidad y aumentan fiabilidad.
AUD_LORA_CR=5

# Tamaño medio de payload (bytes) si no se especifica en los eventos.
AUD_LORA_PAYLOAD=20


# --- REGISTRO DE TELEMETRÍA (OPCIONAL) ---------------------------------------

# 1 para grabar automáticamente los paquetes de telemetría recibidos.
# 0 para desactivar el guardado.
LOG_TELEMETRY=1

# Activa el log completo de paquetes del broker.
# 0 = desactivado (por defecto), 1 = grabar todas las tramas que ve el broker.
BROKER_ENABLE_PACKET_LOG=0

# Ruta del fichero JSONL donde se guardarán los paquetes completos.
# Si no se indica, se usará bot_data/packet_log.jsonl.
BROKER_PACKET_LOG_PATH=bot_data/packet_log.jsonl

# Tamaño máximo del fichero de log de paquetes, en MB.
# Al superarlo, se rota el fichero añadiendo timestamp al nombre.
BROKER_PACKET_LOG_MAX_MB=50


# --- Emergencias APRS ---
# Palabras clave que activan modo emergencia si aparecen en el texto APRS
APRS_EMERGENCY_KEYWORDS=EMERGENCIA,EMERGENCY,MAYDAY,SOS,AYUDA

# Destinos APRS (campo DEST) considerados emergencias
APRS_EMERGENCY_DESTS=EMERGENCY,EMERG,SOS

# Canales Mesh dedicados a emergencias (lista de canales 0..15, separada por comas)
# Si está vacío, SOLO se usa el canal indicado por [CH x]
# ejemplo, pon los que quieras o déjalo vacío
MESH_EMERGENCY_CHANNELS=

# Radio máximo (km) para considerar que una emergencia es LOCAL respecto a HOME_LAT/LON
# 0 o vacío -> sin geofencing (no se clasifica LOCAL/REMOTA por distancia)
APRS_EMERGENCY_MAX_KM=50

# Chats de Telegram donde avisar emergencias (opcional)
# Si se deja vacío, se usan ADMIN_IDS
TELEGRAM_EMERG_CHAT_IDS=
